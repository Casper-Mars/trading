# 量化交易策略流程图

## 策略决策流程总览

```mermaid
flowchart TD
    A[市场数据输入] --> B[数据预处理]
    B --> C[指标计算]
    C --> D[策略信号生成]
    D --> E{信号类型判断}
    
    E -->|买入信号| F[买入策略执行]
    E -->|卖出信号| G[卖出策略执行]
    E -->|持有信号| H[持仓管理]
    
    F --> I[仓位管理]
    G --> I
    H --> I
    
    I --> J[风险控制]
    J --> K{风险检查}
    
    K -->|风险可控| L[订单执行]
    K -->|风险超限| M[风险处理]
    
    L --> N[交易监控]
    M --> N
    
    N --> O[绩效评估]
    O --> P[策略优化]
    P --> C
```

## 技术分析策略流程

### 趋势跟踪策略流程

```mermaid
flowchart TD
    A[价格数据] --> B[计算移动平均线]
    B --> C[计算MACD]
    B --> D[计算ADX]
    
    C --> E{MACD金叉?}
    D --> F{ADX>25?}
    B --> G{均线多头排列?}
    
    E -->|是| H[趋势信号+1]
    E -->|否| I[趋势信号+0]
    
    F -->|是| J[强趋势确认]
    F -->|否| K[弱趋势/震荡]
    
    G -->|是| L[多头趋势确认]
    G -->|否| M[空头或震荡]
    
    H --> N{综合信号评分}
    I --> N
    J --> N
    K --> N
    L --> N
    M --> N
    
    N -->|评分≥2| O[生成买入信号]
    N -->|评分≤-2| P[生成卖出信号]
    N -->|其他| Q[保持观望]
    
    O --> R[执行买入策略]
    P --> S[执行卖出策略]
    Q --> T[继续监控]
```

### 均值回归策略流程

```mermaid
flowchart TD
    A[价格数据] --> B[计算布林带]
    A --> C[计算RSI]
    A --> D[计算随机指标]
    
    B --> E{价格位置}
    C --> F{RSI水平}
    D --> G{KD指标}
    
    E -->|触及下轨| H[超卖信号]
    E -->|触及上轨| I[超买信号]
    E -->|在中轨附近| J[中性信号]
    
    F -->|RSI<30| K[超卖确认]
    F -->|RSI>70| L[超买确认]
    F -->|30-70| M[正常区间]
    
    G -->|%K<20| N[超卖支持]
    G -->|%K>80| O[超买支持]
    G -->|20-80| P[中性区间]
    
    H --> Q{多指标确认}
    I --> Q
    J --> Q
    K --> Q
    L --> Q
    M --> Q
    N --> Q
    O --> Q
    P --> Q
    
    Q -->|超卖确认| R[生成买入信号]
    Q -->|超买确认| S[生成卖出信号]
    Q -->|信号不明确| T[继续观察]
    
    R --> U[执行反转买入]
    S --> V[执行反转卖出]
    T --> W[保持当前仓位]
```

## 基本面策略流程

### 价值投资策略流程

```mermaid
flowchart TD
    A[财务数据] --> B[计算估值指标]
    A --> C[计算盈利指标]
    A --> D[计算财务健康指标]
    
    B --> E{PE<行业均值80%?}
    B --> F{PB<1.5且>0.8?}
    C --> G{ROE>10%?}
    D --> H{资产负债率<60%?}
    
    E -->|是| I[估值合理+1]
    E -->|否| J[估值偏高+0]
    
    F -->|是| K[账面价值合理+1]
    F -->|否| L[账面价值风险+0]
    
    G -->|是| M[盈利能力良好+1]
    G -->|否| N[盈利能力一般+0]
    
    H -->|是| O[财务稳健+1]
    H -->|否| P[财务风险+0]
    
    I --> Q{综合评分}
    J --> Q
    K --> Q
    L --> Q
    M --> Q
    N --> Q
    O --> Q
    P --> Q
    
    Q -->|评分≥3| R[价值投资标的]
    Q -->|评分2| S[观察标的]
    Q -->|评分≤1| T[排除标的]
    
    R --> U[建立仓位]
    S --> V[加入观察池]
    T --> W[移出选股池]
    
    U --> X[长期持有]
    V --> Y[定期复评]
    
    X --> Z[定期基本面检查]
    Y --> Z
    Z --> AA{基本面是否恶化?}
    
    AA -->|否| BB[继续持有]
    AA -->|是| CC[考虑卖出]
    
    BB --> Z
    CC --> DD[执行卖出]
```

### 成长投资策略流程

```mermaid
flowchart TD
    A[财务数据] --> B[计算成长指标]
    A --> C[行业分析]
    A --> D[竞争地位分析]
    
    B --> E{营收增长率>15%?}
    B --> F{净利润增长率>20%?}
    B --> G{增长率是否加速?}
    
    C --> H{行业景气度}
    D --> I{市场份额变化}
    D --> J{竞争优势}
    
    E -->|是| K[营收增长良好]
    E -->|否| L[营收增长不足]
    
    F -->|是| M[利润增长强劲]
    F -->|否| N[利润增长疲软]
    
    G -->|是| O[增长加速]
    G -->|否| P[增长放缓]
    
    H -->|向上| Q[行业利好]
    H -->|向下| R[行业不利]
    
    I -->|扩大| S[份额提升]
    I -->|缩小| T[份额下降]
    
    J -->|明显| U[优势突出]
    J -->|一般| V[优势不明]
    
    K --> W{成长性评估}
    L --> W
    M --> W
    N --> W
    O --> W
    P --> W
    Q --> W
    R --> W
    S --> W
    T --> W
    U --> W
    V --> W
    
    W -->|高成长| X[重点关注]
    W -->|中等成长| Y[适度关注]
    W -->|低成长| Z[排除关注]
    
    X --> AA[建立仓位]
    Y --> BB[小仓位试探]
    Z --> CC[移出选股池]
    
    AA --> DD[密切跟踪业绩]
    BB --> DD
    
    DD --> EE{业绩是否符合预期?}
    
    EE -->|超预期| FF[增加仓位]
    EE -->|符合预期| GG[维持仓位]
    EE -->|低于预期| HH[减少仓位]
    
    FF --> DD
    GG --> DD
    HH --> II{是否继续持有?}
    
    II -->|是| DD
    II -->|否| JJ[清仓离场]
```

## 风险管理流程

### 仓位管理流程

```mermaid
flowchart TD
    A[交易信号] --> B[计算目标仓位]
    B --> C{仓位计算方法}
    
    C -->|等权重| D[1/N分配]
    C -->|风险平价| E[1/σ分配]
    C -->|凯利公式| F[最优f*计算]
    
    D --> G[基础仓位]
    E --> G
    F --> G
    
    G --> H{风险检查}
    
    H -->|单股仓位>10%| I[仓位过大警告]
    H -->|行业集中度>30%| J[行业集中警告]
    H -->|总仓位>90%| K[总仓位过高警告]
    H -->|风险可控| L[仓位合规]
    
    I --> M[调整单股仓位]
    J --> N[调整行业配置]
    K --> O[降低总仓位]
    L --> P[执行交易]
    
    M --> Q[重新风险检查]
    N --> Q
    O --> Q
    
    Q --> R{调整后风险}
    
    R -->|仍超限| S[进一步调整]
    R -->|风险可控| P
    
    S --> M
    P --> T[仓位监控]
    
    T --> U[定期再平衡]
    U --> V{再平衡触发条件}
    
    V -->|权重偏离>5%| W[执行再平衡]
    V -->|时间触发| W
    V -->|无需调整| X[继续监控]
    
    W --> B
    X --> T
```

### 止损策略流程

```mermaid
flowchart TD
    A[建仓完成] --> B[设置止损位]
    B --> C{止损类型选择}
    
    C -->|固定止损| D[设置固定百分比]
    C -->|ATR止损| E[计算ATR止损位]
    C -->|技术止损| F[设置技术位止损]
    
    D --> G["止损位 = 买入价 × (1-止损%)"]
    E --> H[止损位 = 买入价 - N×ATR]
    F --> I[止损位 = 关键支撑位]
    
    G --> J[实时价格监控]
    H --> J
    I --> J
    
    J --> K{价格变化方向}
    
    K -->|价格上涨| L[移动止损检查]
    K -->|价格下跌| M[止损触发检查]
    K -->|价格横盘| N[维持当前止损]
    
    L --> O{是否启用移动止损?}
    
    O -->|是| P[上调止损位]
    O -->|否| Q[维持原止损位]
    
    P --> R["新止损位 = MAX(原止损位, 当前价格-移动距离)"]
    Q --> S[继续监控]
    
    M --> T{价格≤止损位?}
    
    T -->|是| U[触发止损]
    T -->|否| V[继续持有]
    
    U --> W[执行止损卖出]
    V --> S
    N --> S
    R --> S
    
    W --> X[止损执行完成]
    S --> J
    
    X --> Y[分析止损原因]
    Y --> Z{止损类型分析}
    
    Z -->|正常止损| AA[策略有效]
    Z -->|假突破| BB[考虑调整止损参数]
    Z -->|系统性风险| CC[评估整体策略]
    
    AA --> DD[记录交易结果]
    BB --> DD
    CC --> DD
    
    DD --> EE[优化止损策略]
```

### 风险监控流程

```mermaid
flowchart TD
    A[实时数据] --> B[计算风险指标]
    B --> C[VaR计算]
    B --> D[回撤计算]
    B --> E[波动率计算]
    B --> F[相关性计算]
    
    C --> G{VaR风险等级}
    D --> H{回撤风险等级}
    E --> I{波动率风险等级}
    F --> J{集中度风险等级}
    
    G -->|VaR<限额80%| K[绿色-安全]
    G -->|80%≤VaR<100%| L[黄色-警告]
    G -->|VaR≥100%| M[红色-危险]
    
    H -->|回撤<5%| N[绿色-安全]
    H -->|5%≤回撤<10%| O[黄色-警告]
    H -->|回撤≥10%| P[红色-危险]
    
    I -->|波动率正常| Q[绿色-安全]
    I -->|波动率偏高| R[黄色-警告]
    I -->|波动率异常| S[红色-危险]
    
    J -->|分散良好| T[绿色-安全]
    J -->|适度集中| U[黄色-警告]
    J -->|过度集中| V[红色-危险]
    
    K --> W[正常交易]
    L --> X[风险预警]
    M --> Y[风险处理]
    N --> W
    O --> X
    P --> Y
    Q --> W
    R --> X
    S --> Y
    T --> W
    U --> X
    V --> Y
    
    W --> Z[继续监控]
    X --> AA[风险分析]
    Y --> BB[紧急处理]
    
    AA --> CC{风险原因分析}
    
    CC -->|市场因素| DD[调整仓位]
    CC -->|策略因素| EE[优化策略]
    CC -->|系统因素| FF[检查系统]
    
    BB --> GG{处理措施}
    
    GG -->|减仓| HH[降低风险敞口]
    GG -->|对冲| II[建立对冲仓位]
    GG -->|暂停| JJ[暂停交易]
    
    DD --> KK[执行调整]
    EE --> KK
    FF --> KK
    HH --> KK
    II --> KK
    JJ --> KK
    
    KK --> LL[风险重新评估]
    LL --> MM{风险是否缓解?}
    
    MM -->|是| Z
    MM -->|否| BB
    
    Z --> B
```

## 策略优化流程

### 参数优化流程

```mermaid
flowchart TD
    A[策略表现评估] --> B{是否需要优化?}
    
    B -->|表现良好| C[维持当前参数]
    B -->|表现不佳| D[启动优化流程]
    
    D --> E[确定优化目标]
    E --> F{优化目标类型}
    
    F -->|收益最大化| G[最大化年化收益]
    F -->|风险最小化| H[最小化最大回撤]
    F -->|风险调整收益| I[最大化夏普比率]
    
    G --> J[设置参数范围]
    H --> J
    I --> J
    
    J --> K[选择优化方法]
    K --> L{优化算法选择}
    
    L -->|网格搜索| M[遍历参数组合]
    L -->|遗传算法| N[进化优化]
    L -->|贝叶斯优化| O[概率模型优化]
    
    M --> P[回测所有组合]
    N --> Q[种群进化迭代]
    O --> R[高斯过程建模]
    
    P --> S[评估结果]
    Q --> S
    R --> S
    
    S --> T{样本内表现}
    
    T -->|表现优异| U[样本外验证]
    T -->|表现一般| V[扩大搜索范围]
    T -->|表现较差| W[重新设计策略]
    
    U --> X{样本外表现}
    
    X -->|表现稳定| Y[参数优化成功]
    X -->|表现不稳定| Z[可能过拟合]
    
    V --> J
    W --> AA[策略重构]
    
    Y --> BB[部署新参数]
    Z --> CC[增加正则化]
    
    CC --> DD[重新优化]
    DD --> U
    
    BB --> EE[实盘验证]
    EE --> FF{实盘表现}
    
    FF -->|符合预期| GG[正式使用]
    FF -->|不符合预期| HH[回滚参数]
    
    GG --> II[定期监控]
    HH --> JJ[分析原因]
    
    II --> KK[下次优化周期]
    JJ --> LL[策略改进]
    
    KK --> A
    LL --> D
    
    C --> MM[定期检查]
    MM --> A
    
    AA --> NN[新策略开发]
    NN --> OO[新策略测试]
    OO --> PP{新策略效果}
    
    PP -->|效果好| BB
    PP -->|效果差| AA
```

### 机器学习优化流程

```mermaid
flowchart TD
    A[历史数据] --> B[特征工程]
    B --> C[数据预处理]
    C --> D[特征选择]
    D --> E[模型选择]
    
    E --> F{模型类型}
    
    F -->|监督学习| G[分类/回归模型]
    F -->|无监督学习| H[聚类/降维模型]
    F -->|强化学习| I[智能体训练]
    
    G --> J[随机森林/XGBoost]
    G --> K[神经网络/深度学习]
    G --> L[支持向量机/逻辑回归]
    
    H --> M[K-means聚类]
    H --> N[PCA降维]
    H --> O[异常检测]
    
    I --> P[Q-learning]
    I --> Q[策略梯度]
    I --> R[Actor-Critic]
    
    J --> S[模型训练]
    K --> S
    L --> S
    M --> S
    N --> S
    O --> S
    P --> T[环境交互训练]
    Q --> T
    R --> T
    
    S --> U[交叉验证]
    T --> V[回测验证]
    
    U --> W{验证结果}
    V --> W
    
    W -->|过拟合| X[调整模型复杂度]
    W -->|欠拟合| Y[增加模型复杂度]
    W -->|效果良好| Z[模型部署]
    
    X --> AA[减少特征/正则化]
    Y --> BB[增加特征/深度]
    
    AA --> S
    BB --> S
    
    Z --> CC[在线学习]
    CC --> DD[模型更新]
    DD --> EE{更新策略}
    
    EE -->|增量学习| FF[小批量更新]
    EE -->|批量学习| GG[定期重训练]
    EE -->|在线学习| HH[实时调整]
    
    FF --> II[模型融合]
    GG --> II
    HH --> II
    
    II --> JJ[集成预测]
    JJ --> KK[交易信号生成]
    KK --> LL[策略执行]
    
    LL --> MM[效果监控]
    MM --> NN{模型衰减检测}
    
    NN -->|性能下降| OO[触发重训练]
    NN -->|性能稳定| PP[继续使用]
    
    OO --> QQ[数据更新]
    QQ --> B
    
    PP --> RR[定期评估]
    RR --> SS[下次更新周期]
    SS --> DD
```

---

*以上流程图展示了量化交易策略的完整决策和执行流程，为策略的系统化实施提供了清晰的指导框架。*